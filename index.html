<c!DOCTYPE html>
<meta charset="utf-8">
<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>UFO Finder</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/superhero/bootstrap.min.css">
  <link href="https://fonts.googleapis.com/css?family=Ubuntu" rel="stylesheet">
  <link rel="stylesheet" href="static/css/style.css">
</head>
<body>
  <div class="wrapper">
    <nav class="navbar navbar-default">
      <div class="container-fluid">
        <div class="navbar-header">
          <a class="navbar-brand" href="index.html">UFO Sightings
            <img class="nav-ufo" src="static/images/ufo.svg">
          </a>
        </div>
      </div>
    </nav>
    <div class="hero text-center">
      <h1>UFO Sightings</h1>
      <p>The Truth is Out There</p>
      <p>There are an infinite number of universes existing side by side and through which our consciousnesses constantly pass. In these universes, all possibilities exist. You are alive in some, long dead in others, and never existed in still others. Many of our "ghosts" could indeed be visions of people going about their business in a parallel universe or another time -- or both.

PAUL F. ENO, Faces at the Window</p>
<div class="box1" >
      <p>Week 14 | HW - JavaScript and DOM Manipulation</p>
      <p>Ghassan Aleqabi, PhD, Geoscientist, Data Analytic and Visulization</p>
</div>
<div class="box2" >
      <p>




</p>
      <p></p>
      <p></p>
      <p>Table attriubutes are searchable and sortable "click on the attribute  in table header field to sort asending or desending also fill in any of the searchBar to search the the file</p>
</div>
    </div>

<style>
.box1 {
    display: block;
    padding: 10px;
    margin-bottom: 10px;
    text-align: Right;
}
body {
  background-color: #ff0000;
  font: 14px sans-serif;
}

tbody tr:nth-child(odd){
  background-color: #4C8BF5;
  color: #CCffff;
}

#title {
  font: 26px sans-serif;
  position: absolute;
  top: -40px;
  left: 450px;
}

#FilterableTable {
  width: 100%;
  height: 100%;
  position: absolute;
  top: 40px;
  left: 20px;
}
.SearchBar1 {
  display: inline;
  position: relative;
  left: 1%;
}

.SearchBar1 input {
  position: relative;
  left: 1%;
}

.SearchBar { 
  display: inline; 
  position: relative;
  left: 1%;
}

.SearchBar input {
  position: relative;
  left: 1%;
}

table { 
  position: absolute;
  top: 40px;
  left: 20px;
  border-collapse: collapse;
  margin-bottom: 20px;
}

table a:link, a:visited { text-decoration: none; }

table a:hover, a:active { text-decoration: underline; }

table, th, td { border: 1px solid black; }

td, th {
  padding: 5px;
  text-align: center;
  height: 20px;
}

th {
  background-color: #4393c3;
  color: #d9f0a3;
}

td { background-color: #bbbbbb; }
tr:hover td { background-color: yellow; }
/*tr:hover td { background-color: #edf8b1; } */
#container {
  width: 100% ;
  height: 100%;
  position:absolute;
 background-color: red;
  padding: 10px;
}
</style>


<script src="http://d3js.org/d3.v3.js"></script>
<script>

var column_names=  ["Date", "City", "State", "Country", "Shape", "Duration Minutes","Comments"]
var clicks = { Date: 0,datetime: 0, city: 0, state: 0, country: 0, comments: 0, shape: 0};

// draw the table
d3.select("body").append("div")
  .attr("id", "container")

d3.select("#container").append("div")
  .attr("id", "FilterableTable");

//ghassan
d3.select("#FilterableTable").append("div")
  .attr("class", "SearchBar")
  .append("p")
   .attr("class", "SearchBar")
   .text("Search By City:");

d3.select(".SearchBar")
  .append("input")
    .attr("class", "SearchBar")
    .attr("id", "search")
    .attr("type", "text")
    .attr("placeholder", "Search by City...");
//ghassan
//ghassan

d3.select("#FilterableTable").append("div")
  .attr("class", "SearchBar1")
  .append("p")
   .attr("class", "SearchBar")
   .text("Search By state:");

d3.select(".SearchBar1")
  .append("input")
    .attr("class", "SearchBar")
    .attr("id", "search1")
    .attr("type", "text")
    .attr("placeholder", "Search by state...");

/*
d3.select("#FilterableTable").append("div")
  .attr("class", "SearchBar2")
  .append("p")
   .attr("class", "SearchBar")
   .text("Search By state:");

*/
d3.select(".SearchBar1")
  .append("input")
    .attr("class", "SearchBar1")
    .attr("id", "search2")
    .attr("type", "text")
    .attr("placeholder", "Search by country...");

d3.select(".SearchBar1")
  .append("input")
    .attr("class", "SearchBar1")
    .attr("id", "search3")
    .attr("type", "text")
    .attr("placeholder", "Search by Shape...");

d3.select(".SearchBar1")
  .append("input")
    .attr("class", "SearchBar1")
    .attr("id", "search4")
    .attr("type", "text")
    .attr("placeholder", " Date 1/1/2010-13/1/2010");

var table = d3.select("#FilterableTable").append("table");

var table = d3.select("#FilterableTable").append("table");
table.append("thead").append("tr"); 

var headers = table.select("tr").selectAll("th")
    .data(column_names)
  .enter()
    .append("th")
    .text(function(d) { return d; });

var rows, row_entries, row_entries_no_anchor, row_entries_with_anchor;
  
d3.json("data1.json", function(data) { // loading data from data1.json
  
  // draw table body with rows
  table.append("tbody")

  // data bind
  rows = table.select("tbody").selectAll("tr")
    .data(data, function(d){ return d.id });
  
  // enter the rows
  rows.enter()
    .append("tr")
  
  // enter td's in each row
  row_entries = rows.selectAll("td")
      .data(function(d) { 
        var arr = [];
        for (var k in d) {
          if (d.hasOwnProperty(k)) {
		    arr.push(d[k]);
          }
        }
//        return [arr[3],arr[1],arr[0],arr[6]];
  return [arr[0],arr[1],arr[2],arr[3],arr[4],arr[5],arr[6]];
      })
    .enter()
      .append("td") 

  // draw row entries with no anchor 
  row_entries_no_anchor = row_entries.filter(function(d) {
    return (/https?:\/\//.test(d) == false)
  })
  row_entries_no_anchor.text(function(d) { return d; })

  // draw row entries with anchor
  row_entries_with_anchor = row_entries.filter(function(d) {
    return (/https?:\/\//.test(d) == true)  
  })
  row_entries_with_anchor
    .append("a")
    .attr("href", function(d) { return d; })
    .attr("target", "_blank")
  .text(function(d) { return d; })
    
    
  /**  search functionality for cities **/
    d3.select("#search")
      .on("keyup", function() { // filter according to key pressed 
        var searched_data = data,
            text = this.value.trim();
       //ghassan 
        var searchResults = searched_data.map(function(r) {
          var regex = new RegExp("^" + text + ".*", "i");
          if (regex.test(r.city)) { // if there are any results
          //if (regex.test(r.city)) { // if there are any results
            return regex.exec(r.city)[0]; // return them to searchResults
          } 
        })
	    
	    // filter blank entries from searchResults
        searchResults = searchResults.filter(function(r){ 
          return r != undefined;
        })
        
        // filter dataset with searchResults
        searched_data = searchResults.map(function(r) {
           return data.filter(function(p) {
            return p.city.indexOf(r) != -1;
            //return p.title.indexOf(r) != -1;
          })
        })

        // flatten array 
		searched_data = [].concat.apply([], searched_data)
        
        // data bind with new data
		rows = table.select("tbody").selectAll("tr")
		  .data(searched_data, function(d){ return d.id; })
		
        // enter the rows
        rows.enter()
         .append("tr");
         
        // enter td's in each row
        row_entries = rows.selectAll("td")
            .data(function(d) { 
              var arr = [];
              for (var k in d) {
                if (d.hasOwnProperty(k)) {
		          arr.push(d[k]);
                }
              }
return [arr[0],arr[1],arr[2],arr[3],arr[4],arr[5],arr[6]];
            })
          .enter()
            .append("td") 
// draw row entries with no anchor
        row_entries_no_anchor = row_entries.filter(function(d) {
          return (/https?:\/\//.test(d) == false)
        })
        row_entries_no_anchor.text(function(d) { return d; })

        // draw row entries with anchor
        row_entries_with_anchor = row_entries.filter(function(d) {
          return (/https?:\/\//.test(d) == true)
        })
        row_entries_with_anchor
          .append("a")
          .attr("href", function(d) { return d; })
          .attr("target", "_blank")
        .text(function(d) { return d; })

        // exit
        rows.exit().remove();
      })

  /**  search functionality states **/
    d3.select("#search1")
      .on("keyup", function() { // filter according to key pressed 
        var searched_data = data,
            text = this.value.trim();
       //ghassan 
        var searchResults = searched_data.map(function(r) {
          var regex = new RegExp("^" + text + ".*", "i");
          if (regex.test(r.state)) { // if there are any results
          //if (regex.test(r.state)) { // if there are any results
            return regex.exec(r.state)[0]; // return them to searchResults
          } 
        })
	    
	    // filter blank entries from searchResults
        searchResults = searchResults.filter(function(r){ 
          return r != undefined;
        })
        
        // filter dataset with searchResults
        searched_data = searchResults.map(function(r) {
           return data.filter(function(p) {
            return p.state.indexOf(r) != -1;
            //return p.title.indexOf(r) != -1;
          })
        })

        // flatten array 
		searched_data = [].concat.apply([], searched_data)
        
        // data bind with new data
		rows = table.select("tbody").selectAll("tr")
		  .data(searched_data, function(d){ return d.id; })
		
        // enter the rows
        rows.enter()
         .append("tr");
         
        // enter td's in each row
        row_entries = rows.selectAll("td")
            .data(function(d) { 
              var arr = [];
              for (var k in d) {
                if (d.hasOwnProperty(k)) {
		          arr.push(d[k]);
                }
              }
return [arr[0],arr[1],arr[2],arr[3],arr[4],arr[5],arr[6]];
            })
          .enter()
            .append("td") 

        // draw row entries with no anchor 
        row_entries_no_anchor = row_entries.filter(function(d) {
          return (/https?:\/\//.test(d) == false)
        })
        row_entries_no_anchor.text(function(d) { return d; })

        // draw row entries with anchor
        row_entries_with_anchor = row_entries.filter(function(d) {
          return (/https?:\/\//.test(d) == true)  
        })
        row_entries_with_anchor
          .append("a")
          .attr("href", function(d) { return d; })
          .attr("target", "_blank")
        .text(function(d) { return d; })
        
        // exit
        rows.exit().remove();
      })
  /**  search functionality for countries **/
    d3.select("#search2")
      .on("keyup", function() { // filter according to key pressed 
        var searched_data = data,
            text = this.value.trim();
       //ghassan 
        var searchResults = searched_data.map(function(r) {
          var regex = new RegExp("^" + text + ".*", "i");
          if (regex.test(r.country)) { // if there are any results
          //if (regex.test(r.country)) { // if there are any results
            return regex.exec(r.country)[0]; // return them to searchResults
          } 
        })
	    
	    // filter blank entries from searchResults
        searchResults = searchResults.filter(function(r){ 
          return r != undefined;
        })
        
        // filter dataset with searchResults
        searched_data = searchResults.map(function(r) {
           return data.filter(function(p) {
            return p.country.indexOf(r) != -1;
          })
        })

        // flatten array 
		searched_data = [].concat.apply([], searched_data)
        
        // data bind with new data
		rows = table.select("tbody").selectAll("tr")
		  .data(searched_data, function(d){ return d.id; })
		
        // enter the rows
        rows.enter()
         .append("tr");
         
        // enter td's in each row
        row_entries = rows.selectAll("td")
            .data(function(d) { 
              var arr = [];
              for (var k in d) {
                if (d.hasOwnProperty(k)) {
		          arr.push(d[k]);
                }
              }
return [arr[0],arr[1],arr[2],arr[3],arr[4],arr[5],arr[6]];
            })
          .enter()
            .append("td") 
// draw row entries with no anchor
        row_entries_no_anchor = row_entries.filter(function(d) {
          return (/https?:\/\//.test(d) == false)
        })
        row_entries_no_anchor.text(function(d) { return d; })

        // draw row entries with anchor
        row_entries_with_anchor = row_entries.filter(function(d) {
          return (/https?:\/\//.test(d) == true)
        })
        row_entries_with_anchor
          .append("a")
          .attr("href", function(d) { return d; })
          .attr("target", "_blank")
        .text(function(d) { return d; })

        // exit
        rows.exit().remove();
      })
    
  /**  search functionality for shapes **/
    d3.select("#search3")
      .on("keyup", function() { // filter according to key pressed 
        var searched_data = data,
            text = this.value.trim();
       //ghassan 
        var searchResults = searched_data.map(function(r) {
          var regex = new RegExp("^" + text + ".*", "i");
          if (regex.test(r.shape)) { // if there are any results
          //if (regex.test(r.shape)) { // if there are any results
            return regex.exec(r.shape)[0]; // return them to searchResults
          } 
        })
	    
	    // filter blank entries from searchResults
        searchResults = searchResults.filter(function(r){ 
          return r != undefined;
        })
        
        // filter dataset with searchResults
        searched_data = searchResults.map(function(r) {
           return data.filter(function(p) {
            return p.shape.indexOf(r) != -1;
          })
        })

        // flatten array 
		searched_data = [].concat.apply([], searched_data)
        
        // data bind with new data
		rows = table.select("tbody").selectAll("tr")
		  .data(searched_data, function(d){ return d.id; })
		
        // enter the rows
        rows.enter()
         .append("tr");
         
        // enter td's in each row
        row_entries = rows.selectAll("td")
            .data(function(d) { 
              var arr = [];
              for (var k in d) {
                if (d.hasOwnProperty(k)) {
		          arr.push(d[k]);
                }
              }
return [arr[0],arr[1],arr[2],arr[3],arr[4],arr[5],arr[6]];
            })
          .enter()
            .append("td") 
// draw row entries with no anchor
        row_entries_no_anchor = row_entries.filter(function(d) {
          return (/https?:\/\//.test(d) == false)
        })
        row_entries_no_anchor.text(function(d) { return d; })

        // draw row entries with anchor
        row_entries_with_anchor = row_entries.filter(function(d) {
          return (/https?:\/\//.test(d) == true)
        })
        row_entries_with_anchor
          .append("a")
          .attr("href", function(d) { return d; })
          .attr("target", "_blank")
        .text(function(d) { return d; })

        // exit
        rows.exit().remove();
      })


  /**  search functionality for Dates **/
    d3.select("#search4")
      .on("keyup", function() { // filter according to key pressed 
        var searched_data = data,
            text = this.value.trim();
       //ghassan 
        var searchResults = searched_data.map(function(r) {
          var regex = new RegExp("^" + text + ".*", "i");
          if (regex.test(r.datetime)) { // if there are any results
          //if (regex.test(r.datetime)) { // if there are any results
            return regex.exec(r.datetime)[0]; // return them to searchResults
          } 
        })
	    
	    // filter blank entries from searchResults
        searchResults = searchResults.filter(function(r){ 
          return r != undefined;
        })
        
        // filter dataset with searchResults
        searched_data = searchResults.map(function(r) {
           return data.filter(function(p) {
            return p.datetime.indexOf(r) != -1;
          })
        })

        // flatten array 
		searched_data = [].concat.apply([], searched_data)
        
        // data bind with new data
		rows = table.select("tbody").selectAll("tr")
		  .data(searched_data, function(d){ return d.id; })
		
        // enter the rows
        rows.enter()
         .append("tr");
         
        // enter td's in each row
        row_entries = rows.selectAll("td")
            .data(function(d) { 
              var arr = [];
              for (var k in d) {
                if (d.hasOwnProperty(k)) {
		          arr.push(d[k]);
                }
              }
return [arr[0],arr[1],arr[2],arr[3],arr[4],arr[5],arr[6]];
            })
          .enter()
            .append("td") 
// draw row entries with no anchor
        row_entries_no_anchor = row_entries.filter(function(d) {
          return (/https?:\/\//.test(d) == false)
        })
        row_entries_no_anchor.text(function(d) { return d; })

        // draw row entries with anchor
        row_entries_with_anchor = row_entries.filter(function(d) {
          return (/https?:\/\//.test(d) == true)
        })
        row_entries_with_anchor
          .append("a")
          .attr("href", function(d) { return d; })
          .attr("target", "_blank")
        .text(function(d) { return d; })

        // exit
        rows.exit().remove();
      })

  /**  sort functionality **/
  headers
    .on("click", function(d) {
      if (d == "Shape") {
        clicks.shape++;
        // even number of clicks
        if (clicks.shape % 2 == 0) {
          // sort ascending: alphabetically
          rows.sort(function(a,b) {
            if (a.shape.toUpperCase() < b.shape.toUpperCase()) {
              return -1;
            } else if (a.shape.toUpperCase() > b.shape.toUpperCase()) {
              return 1;
            } else {
              return 0;
            }
          });
        // odd number of clicks
        } else if (clicks.shape  % 2 != 0) {
          // sort descending: alphabetically
          rows.sort(function(a,b) {
            if (a.shape.toUpperCase() < b.shape.toUpperCase()) {
              return 1;
            } else if (a.shape.toUpperCase() > b.shape.toUpperCase()) {
              return -1;
            } else {
              return 0;
            }
          });
        }
      }
     if (d == "City") {
        clicks.city++;
        // even number of clicks
        if (clicks.city % 2 == 0) {
          // sort ascending: alphabetically
          rows.sort(function(a,b) {
            if (a.city.toUpperCase() < b.city.toUpperCase()) { 
              return -1;
            } else if (a.city.toUpperCase() > b.city.toUpperCase()) { 
              return 1;
            } else {
              return 0;
            }
          });
        // odd number of clicks
        } else if (clicks.city % 2 != 0) {
          // sort descending: alphabetically
          rows.sort(function(a,b) {
            if (a.city.toUpperCase() < b.city.toUpperCase()) { 
              return 1;
            } else if (a.city.toUpperCase() > b.city.toUpperCase()) { 
              return -1;
            } else {
              return 0;
            }
          });
        }
      }
      if (d == "State") {
        clicks.state++;
        // even number of clicks
        if (clicks.state % 2 == 0) {
          // sort ascending: alphabetically
          rows.sort(function(a,b) {
            if (a.state.toUpperCase() < b.state.toUpperCase()) {
              return -1;
            } else if (a.state.toUpperCase() > b.state.toUpperCase()) {
              return 1;
            } else {
              return 0;
            }
          });
        // odd number of clicks
        } else if (clicks.state % 2 != 0) {
          // sort descending: alphabetically
          rows.sort(function(a,b) {
            if (a.state.toUpperCase() < b.state.toUpperCase()) {
              return 1;
            } else if (a.state.toUpperCase() > b.state.toUpperCase()) {
              return -1;
            } else {
              return 0;
            }
          });
        }
      }
     if (d == "Country") {
        clicks.country++;
        // even number of clicks
        if (clicks.country % 2 == 0) {
          // sort ascending: alphabetically
          rows.sort(function(a,b) {
            if (a.country.toUpperCase() < b.country.toUpperCase()) {
              return -1;
            } else if (a.country.toUpperCase() > b.country.toUpperCase()) {
              return 1;
            } else {
              return 0;
            }
          });
        // odd number of clicks
        } else if (clicks.country % 2 != 0) {
          // sort descending: alphabetically
          rows.sort(function(a,b) {
            if (a.country.toUpperCase() < b.country.toUpperCase()) {
              return 1;
            } else if (a.country.toUpperCase() > b.country.toUpperCase()) {
              return -1;
            } else {
              return 0;
            }
          });
        }
      }
//"2011-02-17T13:38:27Z"
      if (d == "Date") {
        clicks.datetime++;
        if (clicks.datetime % 2 == 0) {
          // sort ascending: by date
          rows.sort(function(a,b) { 
            // grep date and time, split them apart, make Date objects for comparing  
	        var date = new Date(a.datetime)
	        var a_date_obj = new Date(date);
	        var date = new Date(b.datetime)
	        var b_date_obj = new Date(date);
            if (a_date_obj < b_date_obj) { 
              return -1; 
            } else if (a_date_obj > b_date_obj) { 
              return 1; 
            } else {
              return 0;
            }
          });
        // odd number of clicks  
        } else if (clicks.datetime % 2 != 0) { 
          // sort descending: by date
          rows.sort(function(a,b) { 
            // grep date and time, split them apart, make Date objects for comparing  
	        var date = new Date(a.datetime)
	        var a_date_obj = new Date(date);
	        var date = new Date(b.datetime)
	        var b_date_obj = new Date(date);
			          
            if (a_date_obj < b_date_obj) { 
              return 1; 
            } else if (a_date_obj > b_date_obj) { 
              return -1; 
            } else {
              return 0;
            }
          });
        }
      }
      if (d == "Comments") {
        clicks.url++;
	    // even number of clicks
        if (clicks.url % 2 == 0) {
          // sort ascending: alphabetically
          rows.sort(function(a,b) { 
            if (a.thumb_url_default.toUpperCase() < b.thumb_url_default.toUpperCase()) { 
              return -1; 
            } else if (a.thumb_url_default.toUpperCase() > b.thumb_url_default.toUpperCase()) { 
              return 1; 
            } else {
              return 0;
            }
          });
        // odd number of clicks  
        } else if (clicks.url % 2 != 0) { 
          // sort descending: alphabetically
          rows.sort(function(a,b) { 
            if (a.thumb_url_default.toUpperCase() < b.thumb_url_default.toUpperCase()) { 
              return 1; 
            } else if (a.thumb_url_default.toUpperCase() > b.thumb_url_default.toUpperCase()) { 
              return -1; 
            } else {
              return 0;
            }
          });
        }	
      }  
    }) // end of click listeners
});
d3.select(self.frameElement).style("height", "780px").style("width", "1150px");	
</script>
